## spawn

```
use std::thread;
use std::time::Duration;

fn heavy(i: u32) {
    println!("重い処理 {}", i);
    thread::sleep(Duration::from_millis(500));
}

fn main() {
    for i in 1..=10 {
        heavy(i)
    }

    for i in 1..=10 {
        heavy(i)
    }
}
```
spawnで新規スレッドを生成
```
use std::thread;
use std::time::Duration;

fn heavy(i: u32) {
    println!("重い処理 {}", i);
    thread::sleep(Duration::from_millis(500));
}

fn main() {
    let handle = thread::spawn(|| {
        for i in 1..=10 {
            heavy(i);
        }
    });

    for i in 1..=10 {
        heavy(i)
    }

    handle.join().unwrap();
}
```
メインスレッドの値を使うにはmove
```
use std::thread;
use std::time::Duration;

fn heavy(i: u32, s: &str) {
    println!("重い処理 {} {}", i, s);
    thread::sleep(Duration::from_millis(500));
}

fn main() {
    let s = "メインスレッドの値";

    let handle = thread::spawn(move || {
        for i in 1..=10 {
            heavy(i, s);
        }
    });

    for i in 1..=10 {
        heavy(i, s)
    }

    handle.join().unwrap();
}
```

## チャンネル

スレッド間のメッセージ受け渡し

```
use std::thread;
use std::time::Duration;

fn heavy(i: u32) -> u32 {
    thread::sleep(Duration::from_millis(50));
    i * 2
}

fn main() {
    let handle = thread::spawn(|| {
        let mut n = 0;
        for i in 1..=10 {
            n += heavy(i);
            println!("{}", n);
        }
    });

    handle.join().unwrap();
}
```
nをメインスレッドで受けるには
```
use std::sync::mpsc;
use std::thread;
use std::time::Duration;

fn heavy(i: u32) -> u32 {
    thread::sleep(Duration::from_millis(50));
    i * 2
}

fn main() {
    let (tx, rx) = mpsc::channel();

    thread::spawn(move || {
        let mut n = 0;
        for i in 1..=10 {
            n += heavy(i);
            println!("{}", n);
        }
        tx.send(n).unwrap();
    });

    let received = rx.recv().unwrap();
    println!("nは{}", received);
}
```
ループでも送れる
```
use std::sync::mpsc;
use std::thread;
use std::time::Duration;

fn heavy(i: u32) -> u32 {
    thread::sleep(Duration::from_millis(50));
    i * 2
}

fn main() {
    let (tx, rx) = mpsc::channel();

    thread::spawn(move || {
        for i in 1..=10 {
            let n = heavy(i);
            tx.send(n).unwrap();
        }
    });

    for received in rx {
        println!("メインスレッド側 {}", received);
    }
}
```

## randクレート

https://crates.io/crates/rand

Add this to your Cargo.toml:
```
[dependencies]
rand = "0.7"
```
よく使いそうなもの
```
use rand::prelude::*;

fn main() {
    let mut rng = thread_rng();

    let number = rng.gen_range(1, 11);
    println!("1から10までのランダムな数字 {}", number);

    let mut v = vec![1, 2, 3, 4, 5];
    let c = v.choose(&mut rng).unwrap();
    println!("vからランダムに1つ選択 {}", c);

    v.shuffle(&mut rng);
    println!("vをシャッフル {:?}", v);
}
```

